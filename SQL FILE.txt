CREATE DATABASE PROJECT;
USE PROJECT;


CREATE OR REPLACE TABLE orders (
  order_id VARCHAR(255) PRIMARY KEY,
  order_date TIMESTA,
  ship_mode VARCHAR(255),
  segment VARCHAR(255),
  country VARCHAR(255),
  city VARCHAR(255),
  state VARCHAR(255),
  postal_code VARCHAR(255),
  region VARCHAR(255),
  category VARCHAR(255),
  sub_category VARCHAR(255),
  product_id VARCHAR(255),
  cost_price DECIMAL(10, 2),
  list_price DECIMAL(10, 2),
  quantity INTEGER,
  discount_percent DECIMAL(5, 2),
  discount DECIMAL(10, 2),
  sale_price DECIMAL(10, 2),
  profit DECIMAL(10, 2)
);

select * from orders;





-- Find out the top 10 highest generating product ??


SELECT  TOP 10 PRODUCT_ID,SUM(SALE_PRICE) AS REVENUE FROM ORDERS GROUP BY 1 ORDER BY 2 DESC ;



-- FIND TOP 5 SELLING PRODUCT IN EACH REGION ??


WITH CTE AS (
SELECT  PRODUCT_ID,
        REGION,
        SUM(SALE_PRICE) AS TOTAL_REVENUE 
FROM    ORDERS 
GROUP BY 1,2
ORDER BY 2,3 DESC)
SELECT * FROM(
SELECT *,
ROW_NUMBER()OVER (PARTITION BY REGION ORDER BY TOTAL_REVENUE DESC) RN
FROM CTE ) WHERE RN <=5;






---find month over month growth comparison for 2022 and 2023 sales eg : jan 2022 vs jan 2023

WITH CTE AS (
 SELECT TO_CHAR(ORDER_DATE,'MON')MONTH,YEAR(order_date)YEAR,SALE_PRICE FROM ORDERS)
 SELECT 
 MONTH,
 SUM(CASE WHEN YEAR=2022 THEN SALE_PRICE ELSE 0 END )AS SALE_2022,
 SUM(CASE WHEN YEAR=2023 THEN SALE_PRICE ELSE 0 END )AS SALE_2023
 FROM CTE 
 GROUP BY 1
ORDER BY 2;



--for each category which month had highest sales 
WITH CTE AS (
SELECT TO_CHAR(ORDER_DATE,'MM YY') MONTH , CATEGORY ,SUM(SALE_PRICE) TOTAL_SALES FROM ORDERS GROUP BY 2,1 ORDER BY 2),
CTE2 AS 
(SELECT ROW_NUMBER() OVER (PARTITION BY CATEGORY ORDER BY TOTAL_SALES DESC) RN  ,CATEGORY,MONTH,TOTAL_SALES FROM CTE) 
SELECT* FROM CTE2 WHERE RN = 1 ;




----which sub category had highest growth by profit in 2023 compare to 2022


WITH CTE AS (
 SELECT SUB_CATEGORY,YEAR(order_date)YEAR,SUM(PROFIT) TOTAL_PROFIT FROM ORDERS GROUP BY 1,2),
 CTE2 AS(
 SELECT SUB_CATEGORY,
  SUM(CASE WHEN YEAR =2023 THEN TOTAL_PROFIT ELSE 0 END)AS PROFIT_2023,
  SUM(CASE WHEN YEAR =2022 THEN TOTAL_PROFIT ELSE 0 END ) AS PROFIT_2022
  FROM CTE GROUP BY 1 ORDER BY 1 DESC),
  CTE3 AS(
  SELECT SUB_CATEGORY,(PROFIT_2023-PROFIT_2022)AS PROFIT_GROWTH FROM CTE2)
  SELECT  SUB_CATEGORY,(PROFIT_GROWTH) FROM CTE3 ORDER BY 2 DESC LIMIT 1 ;






